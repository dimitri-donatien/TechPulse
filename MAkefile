# 🛠️ Variables
PYTHON=python3
DOCKER_COMPOSE=docker-compose
APP_NAME=techpulse

# 📌 Aide - Liste des commandes disponibles
help:
	@echo "Usage: make [commande]"
	@echo ""
	@echo "Commandes disponibles :"
	@echo "  install      Installe les dépendances Python"
	@echo "  run          Lance le script principal"
	@echo "  test         Exécute les tests unitaires"
	@echo "  lint         Vérifie le code avec flake8"
	@echo "  format       Reformate le code avec black"
	@echo "  docker-build Construit l’image Docker"
	@echo "  docker-run   Démarre l’application avec Docker"
	@echo "  docker-stop  Arrête les conteneurs"
	@echo "  clean        Supprime les fichiers temporaires"
	@echo ""

# 📌 Installation des dépendances
install:
	$(PYTHON) -m pip install --upgrade pip
	$(PYTHON) -m pip install -r requirements.txt

# 📌 Lancer le script principal
run:
	$(PYTHON) main.py

# 📌 Exécuter les tests unitaires
test:
	$(PYTHON) -m unittest discover -s tests

# 📌 Vérifier le code avec Flake8
lint:
	flake8 --max-line-length=100 .

# 📌 Reformater le code avec Black
format:
	black .

# 📌 Construire l’image Docker
docker-build:
	$(DOCKER_COMPOSE) build

# 📌 Lancer l’application avec Docker Compose
docker-run:
	$(DOCKER_COMPOSE) up -d

# 📌 Arrêter les conteneurs Docker
docker-stop:
	$(DOCKER_COMPOSE) down

# 📌 Nettoyer les fichiers inutiles
clean:
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	rm -rf .mypy_cache .pytest_cache
